{{- $pages := where .Site.RegularPages "Section" "blog" -}}
{{- $pages = sort $pages "Date" "desc" -}}

<div class="posts-by-year js-posts-by-year">
  <div class="posts-filter">
    <button type="button" class="filter-btn is-active" data-filter="all" aria-pressed="true">All</button>
    <button type="button" class="filter-btn" data-filter="til" aria-pressed="false">
      <span class="filter-icon">til</span>
    </button>
    <button type="button" class="filter-btn" data-filter="tales" aria-pressed="false">
      <span class="filter-icon">tales</span>
    </button>
  </div>

  {{- range $pages.GroupByDate "2006" -}}
    <section class="posts-year" data-year="{{ .Key }}">
      <h2 class="posts-year-title">{{ .Key }}</h2>
      <div class="posts-list">
        {{- range .Pages -}}
          {{- $postType := .Params.postType | default "" -}}
          {{- if not $postType -}}
            {{- with .Params.tags -}}
              {{- range . -}}
                {{- $tag := lower . -}}
                {{- if or (eq $tag "til") (eq $tag "tales") -}}
                  {{- $postType = $tag -}}
                {{- end -}}
              {{- end -}}
            {{- end -}}
          {{- end -}}
          <article data-kind="{{ $postType }}">
            <h3 class="posts-title">
              <a href="{{ .RelPermalink }}">{{ .Title }}</a>
            </h3>
          {{- $summary := .Params.summary | default .Summary -}}
          {{- if $summary -}}
            <p class="posts-summary">{{ $summary | plainify }}</p>
          {{- end -}}
          <p class="posts-date">{{ .Date.Format "02 Jan 2006" }}</p>
        </article>
      {{- end -}}
    </div>
  </section>
  {{- end -}}
</div>

<style>
  .posts-by-year {
    margin-top: 1.5rem;
    max-width: 100%;
    padding: 0;
  }

  .posts-filter {
    display: flex;
    gap: 0.5rem;
    align-items: center;
    margin-bottom: 1.5rem;
    flex-wrap: wrap;
  }

  .filter-btn {
    border: 1px solid currentColor;
    background: transparent;
    color: inherit;
    padding: 0.35rem 0.75rem;
    border-radius: 999px;
    font-size: 0.85rem;
    cursor: pointer;
    transition: background 0.15s ease, color 0.15s ease, border-color 0.15s ease;
  }

  .filter-btn.is-active {
    background: #1f2937;
    color: #fff;
    border-color: #1f2937;
    box-shadow: 0 0 0 2px rgba(31, 41, 55, 0.2);
  }

  @media (prefers-color-scheme: dark) {
    .filter-btn.is-active {
      background: #f8fafc;
      color: #0f172a;
      border-color: #f8fafc;
      box-shadow: 0 0 0 2px rgba(248, 250, 252, 0.2);
    }
  }

  .filter-icon {
    display: inline-flex;
    align-items: center;
    justify-content: center;
    min-width: 3rem;
    font-weight: 600;
    text-transform: uppercase;
    letter-spacing: 0.08em;
  }

  .posts-year-title {
    margin-top: 2rem;
    font-size: 1.5rem;
    font-weight: 600;
  }

  .posts-list {
    margin-top: 1rem;
    display: grid;
    gap: 1.25rem;
  }

  .posts-title {
    font-size: 1.15rem;
    font-weight: 700;
  }

  .posts-summary {
    margin-top: 0.25rem;
    font-size: 0.9rem;
  }

  .posts-date {
    margin-top: 0.2rem;
    font-size: 0.75rem;
    color: rgba(15, 23, 42, 0.55);
  }

  @media (prefers-color-scheme: dark) {
    .posts-date {
      color: rgba(226, 232, 240, 0.6);
    }
  }
</style>

<script src="{{ "posts-filter.js" | relURL }}" defer></script>
